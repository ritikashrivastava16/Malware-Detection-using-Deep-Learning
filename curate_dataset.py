import pandas as pd
import numpy as np
import os
import random

malware = pd.read_csv("opcode/malware_opcode_sequence.csv")
malware["label"] = 1
malware.to_csv("opcode/malware_opcode_sequence.csv", index=False)

benign = pd.read_csv("opcode/benign_opcode_sequence.csv")
benign["label"] = 0
benign.to_csv("opcode/benign_opcode_sequence.csv", index=False)

malware["seq_clean"] = malware["sequence"].apply(
    lambda x: np.nan
    if x == "[]"
    else x.replace("[", "").replace("]", "").replace(",", "").replace("'", "")
)
malware = malware.dropna()
malware.reset_index(drop=True, inplace=True)

benign["seq_clean"] = benign["sequence"].apply(
    lambda x: np.nan
    if x == "[]"
    else x.replace("[", "").replace("]", "").replace(",", "").replace("'", "")
)
benign = benign.dropna()
benign.reset_index(drop=True, inplace=True)

random.seed(101)

random100 = []
while len(random100) != 100:
    random100.append(random.randint(0, malware.shape[0]))

dataset = pd.DataFrame()
dataset = dataset.append(benign[["filename", "seq_clean", "label"]], ignore_index=True)
dataset = dataset.append(
    malware[["filename", "seq_clean", "label"]].iloc[random100], ignore_index=True
)

dataset.columns = ["filename", "sequence", "label"]
dataset = dataset.sample(frac=1)
dataset.reset_index(drop=True, inplace=True)

dataset.to_csv("dataset.csv", index=False)